<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Posts | Florian Oswald</title><link>https://floswald.github.io/post/</link><atom:link href="https://floswald.github.io/post/index.xml" rel="self" type="application/rss+xml"/><description>Posts</description><generator>Hugo Blox Builder (https://hugoblox.com)</generator><language>en-us</language><copyright>© 2022 Florian Oswald</copyright><lastBuildDate>Wed, 13 Sep 2023 22:54:39 +0200</lastBuildDate><image><url>https://floswald.github.io/media/icon_hu10226378635250344412.png</url><title>Posts</title><link>https://floswald.github.io/post/</link></image><item><title>Create and Rename Files with Fish</title><link>https://floswald.github.io/post/batchrename/</link><pubDate>Wed, 13 Sep 2023 22:54:39 +0200</pubDate><guid>https://floswald.github.io/post/batchrename/</guid><description>&lt;p>I am an avid user of the &lt;a href="https://fishshell.com/" target="_blank" rel="noopener">fish shell&lt;/a>. Here is a small demo of a common task I have. How to efficiently rename a long list of files in a directory?&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># lets create 10 empty text files:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">floswald@PTL11077 ~/test&amp;gt; &lt;span class="k">for&lt;/span> i in &lt;span class="o">(&lt;/span>seq &lt;span class="m">1&lt;/span> 10&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> touch testfile&lt;span class="nv">$i&lt;/span>.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">floswald@PTL11077 ~/test&amp;gt; ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">testfile1.txt testfile2.txt testfile4.txt testfile6.txt testfile8.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">testfile10.txt testfile3.txt testfile5.txt testfile7.txt testfile9.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>no suppose I realize that &lt;code>testfile&lt;/code> is actually a poor name for this. I want to call them &lt;code>trainfile&lt;/code> instead. Here is how to change those filenames in batch instead of manually one by one. The concept is called &lt;a href="https://fishshell.com/docs/current/language.html#command-substitution" target="_blank" rel="noopener">command substition&lt;/a>, as in&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">echo (pwd)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>which evalutes first the command in the bracket before giving it to the &lt;code>echo&lt;/code> command.&lt;/p>
&lt;p>in our case, we use a &lt;code>sed&lt;/code> call to substitute parts of each filename. &lt;code>sed&lt;/code> is extremeley powerful, look here for a concise &lt;a href="https://www.grymoire.com/Unix/Sed.html" target="_blank" rel="noopener">manual&lt;/a>. In our case, we want to substitute &lt;code>test&lt;/code> with &lt;code>train&lt;/code>. The &lt;code>s&lt;/code> command in &lt;code>sed&lt;/code> does that. The syntax is &lt;code>s/old/new/&lt;/code>. So we want to substitute &lt;code>test&lt;/code> with &lt;code>train&lt;/code>. We can do that like this:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">floswald@PTL11077 ~/test &lt;span class="o">[&lt;/span>64&lt;span class="o">]&lt;/span>&amp;gt; &lt;span class="k">for&lt;/span> i in *.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> mv &lt;span class="nv">$i&lt;/span> &lt;span class="o">(&lt;/span> &lt;span class="nb">echo&lt;/span> &lt;span class="nv">$i&lt;/span> &lt;span class="p">|&lt;/span> sed &lt;span class="s1">&amp;#39;s/test/train/g&amp;#39;&lt;/span> &lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> end
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">floswald@PTL11077 ~/test&amp;gt; ls
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">trainfile1.txt trainfile2.txt trainfile4.txt trainfile6.txt trainfile8.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">trainfile10.txt trainfile3.txt trainfile5.txt trainfile7.txt trainfile9.txt
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>VFI on GPU</title><link>https://floswald.github.io/post/gpuvfi/</link><pubDate>Tue, 18 Oct 2022 09:51:22 +0200</pubDate><guid>https://floswald.github.io/post/gpuvfi/</guid><description>&lt;p>Here is a set of slides talking about parallel computation on several devices, including a GPU card, using Julia.&lt;/p>
&lt;p>&lt;strong>Notice&lt;/strong>: this was written quite some time ago (Julia version 1.0), so whatever I&amp;rsquo;ve come up here with may no longer be best practice (if it ever was). So: use at your own risk! 😉&lt;/p></description></item><item><title>Covid Teaching</title><link>https://floswald.github.io/post/covid-teaching/</link><pubDate>Mon, 27 Dec 2021 00:00:00 +0000</pubDate><guid>https://floswald.github.io/post/covid-teaching/</guid><description>&lt;p>The COVID-19 pandemic posed new challenges to teachers at all levels. In university teaching, we were relatively lucky because we could rely on new technologies like zoom and others to host virtual classes. In this post I&amp;rsquo;ll review my and my students&amp;rsquo; experience over the period from September 2020 until December 2021 in this regard. What I have learned is applicable to both online and in-person teaching.&lt;/p>
&lt;details class="toc-inpage d-print-none " open>
&lt;summary class="font-weight-bold">Table of Contents&lt;/summary>
&lt;nav id="TableOfContents">
&lt;ul>
&lt;li>&lt;a href="#course-subjects">Course Subjects&lt;/a>&lt;/li>
&lt;li>&lt;a href="#teaching-philosophy">Teaching Philosophy&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#1-hands-on">1. Hands On&lt;/a>&lt;/li>
&lt;li>&lt;a href="#2-team-work">2. Team Work&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#technology">Technology&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#1-materials-and-accessibility">1. Materials and Accessibility&lt;/a>&lt;/li>
&lt;li>&lt;a href="#2-communication">2. Communication&lt;/a>&lt;/li>
&lt;li>&lt;a href="#3-presentation-mode">3. Presentation Mode&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#undergraduate-econometrics-courses">Undergraduate Econometrics Courses&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#1-introduction-to-econometrics-with-r">1. Introduction to Econometrics with &lt;code>R&lt;/code>&lt;/a>&lt;/li>
&lt;li>&lt;a href="#2-advanced-econometrics">2. Advanced Econometrics&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>&lt;a href="#computational-economics-for-phds">Computational Economics for PhDs&lt;/a>
&lt;ul>
&lt;li>&lt;a href="#testimonials-2">Testimonials&lt;/a>&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul>
&lt;/nav>
&lt;/details>
&lt;h2 id="course-subjects">Course Subjects&lt;/h2>
&lt;p>I taught 3 subjects over this period for the department of economics at SciencesPo Paris, as well as the department of economics at Bocconi University (where I&amp;rsquo;m on sabbatical leave 2021/2022):&lt;/p>
&lt;ol>
&lt;li>Introduction to Econometrics with &lt;code>R&lt;/code> (2nd year undergraduate)&lt;/li>
&lt;li>Advanced Econometrics with &lt;code>R&lt;/code> (3rd year undergraduate)&lt;/li>
&lt;li>Computational Economics (PhD Students)&lt;/li>
&lt;/ol>
&lt;p>The unifying feature of the three courses is that they all use a fair amount of computer code to either help illustrate core concepts (in the econometrics courses), or indeed because code is the main content to talk about (in the computational economics course). I like to think of both sets of courses as &lt;em>data science courses&lt;/em> for Economists. I will first describe the overarching philosphy that guided me when designing these courses, then say a few things about technology and then describe more in detail how each course is set up.&lt;/p>
&lt;br>
&lt;h2 id="teaching-philosophy">Teaching Philosophy&lt;/h2>
&lt;h3 id="1-hands-on">1. Hands On&lt;/h3>
&lt;p>The main overarching idea is that working with computers and software to solve problems &lt;em>needs to be practiced&lt;/em> first hand, i.e. by the students themselves. Presenting a &lt;em>how to do XYZ&lt;/em> cookbook recipe on a slide has only limited value, if it does not serve as an introduction to a practical exercise where students try to actually &lt;em>do XYZ&lt;/em>. To be clear, cookbook recipes, particularly if they provide a fully working example that can be executed by the student from start to finish, are valuable. In all of my courses, I try to encourage this kind of learning by doing with frequent in-class tasks, or homework assignments. Also for the final term project I much prefer to give a take home exam where small teams develop something together, rather than the typical exam format, which does not lend itself naturally to computing tasks, I find.&lt;/p>
&lt;h3 id="2-team-work">2. Team Work&lt;/h3>
&lt;p>I try to encourage as much team work as possible. It is very common that some students had more previous experience with some aspects of a task than others, and there are obvious benefits from the less experienced student of being able to follow the lead of the more experienced one. Next to acquiring the information necessary to complete a task, the student also learns to overcome a certain form of &lt;em>stigma&lt;/em> which deters them from asking questions. To effectively use modern software means to be able to interact with the relevant community for help, hence, asking questions about code is a first order skill that I want students to acquire.
What is less appreciated at times, however, are the benefits to the more experienced student having to explain a concept, which I think are substantial. As many teachers will be able to confirm, teaching also means to view problems from a different angle at times, which can be challenging, but rewarding.
Particularly in a software-centered setting, team work is a great way to keep &lt;em>tooling-related frustration&lt;/em> (the general occurence of &lt;em>this does not work&lt;/em>) at a minimum. &lt;em>Tooling-related frustration&lt;/em> is a big challenge for courses that involve software.&lt;/p>
&lt;br>
&lt;h2 id="technology">Technology&lt;/h2>
&lt;h3 id="1-materials-and-accessibility">1. Materials and Accessibility&lt;/h3>
&lt;p>In my view it is first order important to provide students with a one-stop solution with regards to course materials: a single webpage should host all relevant material. Online-education platforms like moodle or blackboard, for example, offer good solutions, however I personally prefer providing content via &lt;code>Github.com&lt;/code> as a static website (or simply the &lt;code>README.MD&lt;/code> of a code repository). I wrote a lot of code for the material of my courses, either alone or with the help of collaborators, and there is no better environment in my view than a social coding platform like &lt;code>github.com&lt;/code> or other similar services, which is the main source of my preference for this over moodle or blackboard.&lt;/p>
&lt;h3 id="2-communication">2. Communication&lt;/h3>
&lt;p>Clear and simple communication is key, in normal times and much more so in online settings. I try to stay away from email for communication with students and prefer things like Slack, or other chatroom-like platforms. Email is not well suited for discussions, as threads become unreadable and incomprehensible after several replies. Different dedicated &lt;em>channels&lt;/em> in a slack workspace help to organise discussions around certain topics (for instance, the &lt;code>homeworks&lt;/code> or the &lt;code>term paper&lt;/code> channel), while still allowing for private messages to be sent. The public forum aspect is first order important, because the odds of two or more students having very similar problems are very high in any given setting, so there are clear benefits from asking the entire group. A screenshot from this year&amp;rsquo;s computational course at Bocconi in &lt;a href="#figure-slack">figure 1&lt;/a> shows another benefit, which is readable code formatting, and, of course, emojis 🎉!&lt;/p>
&lt;figure id="figure-slack">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="blog-slack.png" alt="Figure 1: Slack Example" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Figure 1: Slack Example
&lt;/figcaption>&lt;/figure>
&lt;p>In general, these are exciting times to try out new environments for teaching, and everything that makes teaching (and learning) more fun and enjoyable should be an option. In November 2020, for example, we used the custom-built &lt;a href="https://www.gather.town/" target="_blank" rel="noopener">gather.town&lt;/a> model of the department of economics at SciencesPo in order to do group work in the econometrics course. Students choose different virtual &amp;ldquo;rooms&amp;rdquo; to sit in (they have to walk around on screen in a very simple 2D setting), and then talk to each other in a video-conference. We found it works very well for group work.&lt;/p>
&lt;blockquote class="twitter-tweet">&lt;p lang="en" dir="ltr">today we over-geeked it in advanced metrics We met in the &lt;a href="https://t.co/qCNYYPb1zJ">https://t.co/qCNYYPb1zJ&lt;/a> model of &lt;a href="https://twitter.com/ScPoEcon?ref_src=twsrc%5Etfw">@ScPoEcon&lt;/a> built by &lt;a href="https://twitter.com/johannesmboehm?ref_src=twsrc%5Etfw">@johannesmboehm&lt;/a>, I streamed via OBS to zoom (for recording), slack chat, sharing R solutions on screen...the full geek stack. I had so 👏much👏fun👏 &lt;a href="https://t.co/VjqSLIaQ0h">pic.twitter.com/VjqSLIaQ0h&lt;/a>&lt;/p>&amp;mdash; Florian Oswald 🇪🇺 🇺🇦 (@FlorianOswald) &lt;a href="https://twitter.com/FlorianOswald/status/1328660455070511107?ref_src=twsrc%5Etfw">November 17, 2020&lt;/a>&lt;/blockquote>
&lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8">&lt;/script>
&lt;h3 id="3-presentation-mode">3. Presentation Mode&lt;/h3>
&lt;p>In online courses, the presentation mode is very important. There is evidence that the attention span in front of a screen is even shorter than in a classroom, hence we face formidable challenges to the traditional 2 hours frontal teaching format. Notice that the need for a full online course only exacerbates those challenges, which exist in normal times as well.&lt;/p>
&lt;p>I have found a simple and low-cost combination of material and tools to be very beneficial for students, &lt;a href="https://twitter.com/lukestein/status/1297306413358866433?s=20" target="_blank" rel="noopener">inspired by others&lt;/a>. In a Zoom-like environment, one has the option to share different input video streams. Using the open source &lt;a href="https://obsproject.com/" target="_blank" rel="noopener">Open Broadcaster Software (OBS)&lt;/a>, a simple green background (clotton cloth or custom green screens) and a little bit of time goes a long way from converting the standard &amp;ldquo;speaker in a little box&amp;rdquo; view into a more engaging setup where the teacher sits within the content (can be any part of the screen, so pdf viewers as well as a web browser or a command terminal.) For an example see &lt;a href="#figure-green">figure 2&lt;/a>.&lt;/p>
&lt;figure id="figure-green">
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="blog-elbow.png" alt="Figure 2: In-content view of teacher via OBS and green screen from *Advanced Econometrics* taught at SciencesPo Paris." loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;figcaption>
Figure 2: In-content view of teacher via OBS and green screen from &lt;em>Advanced Econometrics&lt;/em> taught at SciencesPo Paris.
&lt;/figcaption>&lt;/figure>
&lt;br>
&lt;h2 id="undergraduate-econometrics-courses">Undergraduate Econometrics Courses&lt;/h2>
&lt;br>
&lt;p>We decided to use simulation studies and plenty of interactive apps for teaching Econometrics and to replace the bulk of proofs used traditionally (e.g. the Law of Large Numbers, or biasedness of certain estimators etc). This choice implied that we had to spend less time trying to explain proofs, but had more time to cover the importantl subjects. What is more, we designed a second part to the course for the more motivated students, to satisfy their interest for more in-depth material.&lt;/p>
&lt;h3 id="1-introduction-to-econometrics-with-r">1. Introduction to Econometrics with &lt;code>R&lt;/code>&lt;/h3>
&lt;p>The introduction course is taught to second year students. We collect all relevant material on the &lt;a href="https://github.com/ScPoEcon/ScPoEconometrics-Slides" target="_blank" rel="noopener">code repository&lt;/a> where we develop the code for the slides. Notice the set of contributors on the repository as well, each of which I would like to thank at this point - I was very lucky with this set of Teaching Assistants!&lt;/p>
&lt;p>&lt;strong>Materials:&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>&lt;a href="https://github.com/ScPoEcon/ScPoEconometrics-Slides" target="_blank" rel="noopener">Slides:&lt;/a> I came to like HTML-based slides better than the usual PDF-based ones, mainly because they are easy to distribute (they are just another website), and because I find them much easier to write than with LaTeX. Also, one can include such exotic content as a video (or an emoji! 🤯), which is very helpful sometimes. 😉&lt;/li>
&lt;li>&lt;a href="https://scpoecon.github.io/ScPoEconometrics/" target="_blank" rel="noopener">Online Book: &lt;/a> built with the excellent R bookdown package.&lt;/li>
&lt;li>&lt;a href="https://github.com/ScPoEcon/ScPoApps" target="_blank" rel="noopener">&lt;code>R&lt;/code> shiny apps:&lt;/a> This &lt;code>R&lt;/code> package contains the interactive shiny apps which we use to explain core concepts. The apps illustrate simple statistical concepts, like correlation, to more advanced ones like multicollinearity in a multiple regression setting, all with an interactive element where students can change the main parameters of interest. The apps can be run on each student&amp;rsquo;s own computer, or they can be deployed online via &lt;a href="https://www.shinyapps.io/" target="_blank" rel="noopener">shinyapps&lt;/a>.&lt;/li>
&lt;li>Bi-weekly quizzes deployed to the Moodle platform via the excellent &lt;a href="http://www.r-exams.org/" target="_blank" rel="noopener">&lt;code>R-exams&lt;/code>&lt;/a> package.&lt;/li>
&lt;/ol>
&lt;p>As one can see from browsing the slides, we try to intersperse each session with several &lt;em>tasks&lt;/em> after abour 15-20 minutes of time. Those tasks are not evaluated and serve only to make sure that students understand the current concept. We found those tasks to be very important to &lt;em>immediately&lt;/em> react if a student seems to fall behind on a certain topic. For an example of traditional vs simulation based content, we use no asymptotic theory results to talk about uncertainty in regression estimates, but instead rely on the bootstrap sampling distribution, which we can illustrate effectively in class by having students sample with replacement. This part of our course is based on &lt;a href="https://moderndive.com/" target="_blank" rel="noopener">moderndive&lt;/a>, which we highly recommend for this purpose.&lt;/p>
&lt;h4 id="testimonials">Testimonials&lt;/h4>
&lt;blockquote>
&lt;p>Professor Oswald went above and beyond to research and utilise different resources to make the class as engaging as possible (eg virtual economics department and use of a light board). The use of slack was great also.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>Really interest and potentially very useful content learning how to code. Regular quizzes ensured we kept on top of the content and unlimited time for quizzes meant you could take your time and get to grips with the concepts which I loved. Using examples to highlight concepts also made it much more interesting, and the online Sciences Po classroom was one of the coolest things ever. Really enjoyed the modes of assessment it was so interesting getting to do our own topics and experiment with the code and having the midterm as a blueprint was extremely helpful as a starting point to build upon for the final project.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>The course material was clear and fundamental for the course&amp;rsquo;s comprehension. Mr OSWALD was always helpful and available to clear up any miscomprehension. The course was not easy to grasp sometimes but the quizzes ans tasks were helpful.&lt;/p>
&lt;/blockquote>
&lt;h3 id="2-advanced-econometrics">2. Advanced Econometrics&lt;/h3>
&lt;p>This course is the natural follow-up to what was taught in the intro part and includes core concepts like Instrumental Variables (explained via Directed Acyclic Graphs), Panel Data, Discrete Outcomes and a short but comprehensive introduction to Machine Learning. The slides are available &lt;a href="https://github.com/ScPoEcon/Advanced-Metrics-slides" target="_blank" rel="noopener">on github&lt;/a>, and parts of the book above cover material for this course. In general, we follow exactly the same structure with bi-weekly quizzes on moodle and tasks in class. We also use interactive apps to illustrate for instance &lt;a href="https://floswald.shinyapps.io/ScPoMetrics-ability-bias/" target="_blank" rel="noopener">ability bias in wage regressions and IV&lt;/a>, or the &lt;a href="https://floswald.shinyapps.io/bias_variance/" target="_blank" rel="noopener">bias-variance tradeoff&lt;/a>, or why the &lt;a href="https://floswald.shinyapps.io/marginal_effects_of_logit_probit" target="_blank" rel="noopener">marginal effects of nonlinear models&lt;/a> like Probit and Logit are different from OLS coefficients.&lt;/p>
&lt;h4 id="testimonials-1">Testimonials&lt;/h4>
&lt;blockquote>
&lt;p>This course was really great and a lot of fun. The teacher is great and the content of the course is fascinating. I deeply enjoyed the code part and I&amp;rsquo;m looking forward to studying more of R and other languages used in computational statistics. This course strengthens my desire to pursue economic studies and certainly has given me the taste for research.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>I think that the way we have been taught economectrics is a very good one in the sense that we were often asked to apply theoretical bases to the practice (during the class tutorials) some 10 minutes after learning about it. I feel like it has been very helpful in understanding something quite complicated. I also appreciated that we did those tutorials in teams so that we could share our experience in R (e.g. different R syntax) and our ideas of how to solve the task. The same counts for the bigger projects - midterm and final. Other than that, the slides and the style of teaching were often funny and clear, with practical examples so that we could fully understand the idea behind the econometric methods. Great class.&lt;/p>
&lt;/blockquote>
&lt;br>
&lt;h2 id="computational-economics-for-phds">Computational Economics for PhDs&lt;/h2>
&lt;p>My &lt;a href="https://floswald.github.io/NumericalMethods/" target="_blank" rel="noopener">Computational Economics course&lt;/a> is following the same philosophy as above, but for a more advanced audience. Motivated mostly by things I would have liked to know when I was a graduate student myself - and had to learn the hard way - the material has grown in a somewhat organic fashion. I try to cover the main tools needed to solve and estimate a modern economic model, so nonlinear optimization with constraints is a big part. As above, many aspects of how different algorithms work can be illustrated with a graphical device, and the new &lt;a href="https://github.com/fonsp/Pluto.jl" target="_blank" rel="noopener">Pluto.jl&lt;/a> notebook format is an &lt;em>excellent&lt;/em> teaching environment to create interactive experiences in a very simple way. We introduce the &lt;a href="https://julialang.org/" target="_blank" rel="noopener">&lt;code>julia&lt;/code>&lt;/a> language for technical computing, and treat applications and problems from a wide array of economics: marco applications (like the &lt;a href="https://floswald.github.io/NumericalMethods/lecture7-dp4/" target="_blank" rel="noopener">Aiyagari Model&lt;/a>), or structural micro applications like &lt;a href="https://floswald.github.io/NumericalMethods/lecture10/" target="_blank" rel="noopener">estimation of the Rust Bus Model&lt;/a> with different methods. Again, large part of the value added in my opinion is derived from the homeworks, also available on the &lt;a href="https://floswald.github.io/NumericalMethods/" target="_blank" rel="noopener">course website&lt;/a>.&lt;/p>
&lt;p>In spring 2021 I taught the course as part of the CIVICA pan-european PhD network, with a great group of students from across the continent. 👇&lt;/p>
&lt;blockquote class="twitter-tweet">&lt;p lang="en" dir="ltr">&lt;a href="https://twitter.com/hashtag/EconTwitter?src=hash&amp;amp;ref_src=twsrc%5Etfw">#EconTwitter&lt;/a> Excited! my course &lt;a href="https://t.co/kZrQZMTChM">https://t.co/kZrQZMTChM&lt;/a> is offered to PhD students at 8 (!) top EU Universities this spring! 👇 Still time to sign up! What do you sign up for? Tons of fun with &lt;a href="https://twitter.com/JuliaLang?ref_src=twsrc%5Etfw">@julialang&lt;/a>, we&amp;#39;ll go full &lt;a href="https://twitter.com/PlutoJL?ref_src=twsrc%5Etfw">@PlutoJL&lt;/a> and do lots of *sliding*. Like, lockdown anyone? &lt;a href="https://t.co/uNeYsFQ2d7">https://t.co/uNeYsFQ2d7&lt;/a> &lt;a href="https://t.co/bx04NXgvoy">pic.twitter.com/bx04NXgvoy&lt;/a>&lt;/p>&amp;mdash; Florian Oswald 🇪🇺 🇺🇦 (@FlorianOswald) &lt;a href="https://twitter.com/FlorianOswald/status/1352380924479086599?ref_src=twsrc%5Etfw">January 21, 2021&lt;/a>&lt;/blockquote>
&lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8">&lt;/script>
&lt;h3 id="testimonials-2">Testimonials&lt;/h3>
&lt;blockquote>
&lt;p>the teacher was very approchable, the communication with him was easy and fast, the instructions were always very clear, the content of the course was interesting and I feel like most students of this master should take it&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>The use of online tools was the obvious strength of the course: as a consequence, the e-learning experience was virtually the same as in the classroom.&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;p>Comprehensive explanations, rich varieties of online tools and useful homework. The Prof was very committed to transfer coding skills in different ways.&lt;/p>
&lt;/blockquote></description></item><item><title>EM Benchmarks</title><link>https://floswald.github.io/post/em-benchmarks/</link><pubDate>Sat, 06 Jul 2019 09:56:47 +0200</pubDate><guid>https://floswald.github.io/post/em-benchmarks/</guid><description>&lt;p>I am getting into estimating mixture models at the moment. In particular in the context of models of wage formation where unobserved heterogeneity stemming from both firm and worker side is often modeled with a mixture model. The main assumptions are that&lt;/p>
&lt;ol>
&lt;li>Firms are classifiable into types $l \in \{1,\dots,L\}$, workers into $k \in \{1,\dots,K\}$&lt;/li>
&lt;li>If Worker $i$ is of type $k$ and works for firm $l$ in a certain period, their wages are drawn from distribution $\mathcal{N}(\mu_{k,l},\sigma_{k,l})$.&lt;/li>
&lt;/ol>
&lt;p>This kind of model is at the current frontier of econometrics, and a recent paper is &lt;a href="https://www.econometricsociety.org/publications/econometrica/2019/05/01/distributional-framework-matched-employer-employee-data" target="_blank" rel="noopener">Bonhomme, Lamadon and Manresa (Econometrica 2019)&lt;/a>, ungated &lt;a href="http://www.lamadon.com/paper/blm.pdf" target="_blank" rel="noopener">here&lt;/a>, with a great &lt;a href="https://github.com/tlamadon/blm-replicate" target="_blank" rel="noopener">replication package in &lt;code>R&lt;/code>&lt;/a>.&lt;/p>
&lt;p>The estimation of such models often involves using the &lt;a href="https://en.wikipedia.org/wiki/Expectation%e2%80%93maximization_algorithm" target="_blank" rel="noopener">EM-Algorithm&lt;/a>, which I won&amp;rsquo;t describe in detail here.&lt;/p>
&lt;h2 id="weapon-of-choice">Weapon of Choice?&lt;/h2>
&lt;p>Now before getting to the full model above, I wanted to know my options in terms of programming language. I decided to benchmark a simple version of the above problem: there is only one firm type (&lt;em>all workers at the same firm&lt;/em>), and there are only two worker types, $K=2$. I am considering two options in terms of language: &lt;code>R&lt;/code> and &lt;code>julia&lt;/code>.&lt;/p>
&lt;p>I&amp;rsquo;ll do a hand-coded version in each language, as well as use a package from each:&lt;/p>
&lt;ul>
&lt;li>Hand-coding is relevant because my final problem will need some modification of existing algorithms.&lt;/li>
&lt;li>Packages are relevant because they often provide efficient implementations, and could be the building block on which my extension is based.&lt;/li>
&lt;/ul>
&lt;p>Here goes!&lt;/p>
&lt;h3 id="benchmark-setup">Benchmark Setup&lt;/h3>
&lt;p>I will benchmark everything out of a &lt;code>julia&lt;/code> session by relying on the &lt;a href="https://github.com/JuliaInterop/RCall.jl" target="_blank" rel="noopener">&lt;code>RCall.jl&lt;/code>&lt;/a> package (&lt;a href="https://github.com/floswald/EMbench.jl" target="_blank" rel="noopener">benchmark code on this repo&lt;/a>). &lt;code>RCall.jl&lt;/code> launches an &lt;code>R&lt;/code> session from within &lt;code>julia&lt;/code> and allows to go back and forth with surprisingly little overhead (accesses the same locations in RAM, so no data is copied). The advantage of this is that I can create the exact same benchmarking data to test in both languages. So all code you see here is valid &lt;code>julia&lt;/code>, even though sometimes it contains some &lt;code>R&lt;/code>. Cool, right?🕺&lt;/p>
&lt;p>Here is the data creator:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-julia" data-lang="julia">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> &lt;span class="n">sdata&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">doplot&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">Random&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">seed!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">3333&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># true values&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">μ&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">2.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mf">5.0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">σ&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mf">0.7&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">α&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">0.3&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mf">0.7&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">m&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">MixtureModel&lt;/span>&lt;span class="p">([&lt;/span>&lt;span class="n">Normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">μ&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">σ&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">α&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="n">doplot&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">plot&lt;/span>&lt;span class="p">(&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">plot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">linewidth&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">),&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">plot&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">linewidth&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">fill&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="ss">:red&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="n">components&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="nb">false&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">title&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;Mixture&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span>&lt;span class="n">dpi&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">300&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">savefig&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;mixtures.png&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">y&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">rand&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">m&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">n&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kt">Dict&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="ss">:y&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">:μ&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="n">μ&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">:σ&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="n">σ&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">:α&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="n">α&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>sets true mixture parameters&lt;/li>
&lt;li>creates a &lt;code>Distributions.MixtureModel&lt;/code> data type&lt;/li>
&lt;li>optionally makes a plot from it&lt;/li>
&lt;li>draws &lt;code>n&lt;/code> random realizations from it&lt;/li>
&lt;/ul>
&lt;p>The setup looks like this:&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://floswald.github.io/img/EM-mixtures.png" alt="benchmark data" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>
&lt;/p>
&lt;p>All benchmarks will now proceed in the same way:&lt;/p>
&lt;ol>
&lt;li>Take vector &lt;code>y&lt;/code>&lt;/li>
&lt;li>set (the same) wrong starting values&lt;/li>
&lt;li>run the EM algorithm for &lt;code>iters&lt;/code> iterations to find true values of proportion weights $\alpha$, means $\mu$ and variances $\sigma$ for each component.&lt;/li>
&lt;li>Notice that the starting values are such that the algorithm never fully recovers the true values. Given it&amp;rsquo;s the same data, however, each implementation will follow the same path for parameter values and run the same number of iterations (again, none until convergence).&lt;/li>
&lt;/ol>
&lt;h3 id="julia-by-hand">&lt;code>julia&lt;/code> by hand&lt;/h3>
&lt;p>Here is my relatively naive and &lt;em>just-copy-thy-math&lt;/em> implemenation in &lt;code>julia&lt;/code>:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-julia" data-lang="julia">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> &lt;span class="n">bm_jl&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="kt">Vector&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="kt">Float64&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="n">iters&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># poor starting values&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">μ&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">4.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mf">6.0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">σ&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">α&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">N&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">K&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">length&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">μ&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># initialize objects &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">L&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">zeros&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">N&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">p&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">similar&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="n">iters&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">dists&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="n">Normal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">μ&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">ik&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">σ&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">ik&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">)&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">ik&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="n">K&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># evaluate likelihood for each type &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="n">N&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span> &lt;span class="n">k&lt;/span> &lt;span class="k">in&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="n">K&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># Distributions.jl logpdf()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">L&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">log&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">α&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">])&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">logpdf&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">dists&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">k&lt;/span>&lt;span class="p">],&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">])&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># get posterior of each type &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">p&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">exp&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">L&lt;/span> &lt;span class="o">.-&lt;/span> &lt;span class="n">logsumexp&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">L&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># with p in hand, update &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">α&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">.=&lt;/span> &lt;span class="n">vec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">dims&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">./&lt;/span> &lt;span class="n">N&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">μ&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">.=&lt;/span> &lt;span class="n">vec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">.*&lt;/span> &lt;span class="n">y&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dims&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">./&lt;/span> &lt;span class="n">sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dims&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">σ&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">.=&lt;/span> &lt;span class="n">vec&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sqrt&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span> &lt;span class="o">.*&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span> &lt;span class="o">.-&lt;/span> &lt;span class="n">μ&lt;/span>&lt;span class="o">&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>&lt;span class="o">.^&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dims&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">./&lt;/span> &lt;span class="n">sum&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">p&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">dims&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">)))&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="kt">Dict&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="ss">:α&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="n">α&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">:μ&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="n">μ&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ss">:σ&lt;/span> &lt;span class="o">=&amp;gt;&lt;/span> &lt;span class="n">σ&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="gaussianmixturesjlhttpsgithubcomdavidavdavgaussianmixturesjl">&lt;a href="https://github.com/davidavdav/GaussianMixtures.jl" target="_blank" rel="noopener">&lt;code>GaussianMixtures.jl&lt;/code>&lt;/a>&lt;/h3>
&lt;p>Next is a julia package written for this purpose. Here is the relevant part:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-julia" data-lang="julia">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> &lt;span class="n">bm_jl_GMM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="kt">Vector&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="kt">Float64&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="n">iters&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gmm&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">GMM&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="c"># initialize an empty GMM object&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># stick in our starting values&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gmm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">μ&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">.=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">4.0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="mf">6.0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gmm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">Σ&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">.=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="mf">1.0&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">gmm&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">w&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">.=&lt;/span> &lt;span class="p">[&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="mf">0.5&lt;/span>&lt;span class="p">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># run em!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">em!&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">gmm&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">,&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="p">],&lt;/span>&lt;span class="n">nIter&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">iters&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">gmm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="r-not-so-naive-by-hand">&lt;code>R&lt;/code> not-so-naive by hand&lt;/h3>
&lt;ul>
&lt;li>I tried to vectorize as much as possible here&lt;/li>
&lt;li>Self-imposed rules: no &lt;code>Rcpp&lt;/code>&lt;/li>
&lt;li>You can see this uses an &lt;code>R&lt;/code>-string, where data values are interpolated with a &lt;code>$&lt;/code> into the &lt;code>R&lt;/code> session.&lt;/li>
&lt;/ul>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-julia" data-lang="julia">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># this is a julia function!&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> &lt;span class="n">bm_R&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="n">iters&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="c"># that defines an R-string, sent off to R.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">r_result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">R&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> library(tictoc)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # define a `repeat` function
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> spread &amp;lt;- function (A, loc, dims) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> if (!(is.array(A))) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> A = array(A, dim = c(length(A)))
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> adims = dim(A)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> l = length(loc)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> if (max(loc) &amp;gt; length(dim(A)) + l) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> stop(&amp;#34;incorrect dimensions in spread&amp;#34;)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> sdim = c(dim(A), dims)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> edim = c()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> oi = 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> ni = length(dim(A)) + 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> for (i in c(1:(length(dim(A)) + l))) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> if (i %in% loc) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> edim = c(edim, ni)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> ni = ni + 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> else {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> edim = c(edim, oi)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> oi = oi + 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> return(aperm(array(A, dim = sdim), edim))
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # define row-wise logsumexp
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> logRowSumExp &amp;lt;- function(M) {
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> if (is.null(dim(M))) {return(M)}
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> vms = apply(M,1,max)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> log(rowSums(exp(M-spread(vms,2,dim(M)[2])))) + vms
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # define the function to be timed in R
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> simpleEM &amp;lt;- function(y,iters){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> K = 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> N = length(&lt;/span>&lt;span class="si">$y&lt;/span>&lt;span class="s">)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> EMfun &amp;lt;- function(mu,sigma,alpha,iters){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # allocate arrays
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> p = array(0,c(N,K))
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> L = array(0,c(N,K))
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> for (it in 1:iters){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # E step
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # vectorized over N loop
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> for (k in 1:K){
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> L[ ,k] = log(alpha[k]) + dnorm(y,mean = mu[k], sd = sigma[k], log = TRUE)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> p = exp(L - logRowSumExp(L))
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # M step
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> alpha = colMeans(p)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> mu = colSums(p * y) / colSums(p)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> sigma = sqrt( colSums( p * (y - spread(mu,1,N))^2 ) / colSums(p) )
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> o =list(alpha=alpha,mu=mu,sigma=sigma)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> return(o)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # starting values
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> mu_ = c(4.0,6.0)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> sigma_ = c(1.0,1.0)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> alpha_ = c(0.5,0.5)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> # take time
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> tic()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> out = EMfun(mu_,sigma_,alpha_,iters)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> tt = toc()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> return(list(result = out, time = tt&lt;/span>&lt;span class="si">$toc&lt;/span>&lt;span class="s"> - tt&lt;/span>&lt;span class="si">$tic&lt;/span>&lt;span class="s">))
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> }
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> simpleEM(&lt;/span>&lt;span class="si">$y&lt;/span>&lt;span class="s">,&lt;/span>&lt;span class="si">$iters&lt;/span>&lt;span class="s">) # run function in R!
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">r_result&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="r-mixtools-package">&lt;code>R mixtools&lt;/code> package&lt;/h3>
&lt;p>The &lt;a href="https://cran.r-project.org/web/packages/mixtools/index.html" target="_blank" rel="noopener">&lt;code>mixtools&lt;/code>&lt;/a> package is a very mature and highly optimized package for EM estimation. Most of the computationally intensive parts are written in &lt;code>C&lt;/code>^[For example, in the package source, look for &lt;code>src/normpost.c&lt;/code> which evaluates the matrix of posterior probabilities, object &lt;code>p&lt;/code> in the julia code above. ]. My call:&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-julia" data-lang="julia">&lt;span class="line">&lt;span class="cl">&lt;span class="k">function&lt;/span> &lt;span class="n">bm_R_mixtools&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">y&lt;/span>&lt;span class="o">::&lt;/span>&lt;span class="kt">Vector&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="kt">Float64&lt;/span>&lt;span class="p">};&lt;/span>&lt;span class="n">iters&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="mi">100&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">r_result&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="sa">R&lt;/span>&lt;span class="s">&amp;#34;&amp;#34;&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> library(tictoc)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> library(mixtools)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> mu = c(4.0,6.0)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> sigma = c(1.0,1.0)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> alpha = c(0.5,0.5)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> y = &lt;/span>&lt;span class="si">$y&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> N = length(y)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> K = 2
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> iters = &lt;/span>&lt;span class="si">$iters&lt;/span>&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> tic()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> result = normalmixEM(y,k = K,lambda = alpha, mu = mu, sigma = sigma, maxit = iters)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> tt = toc()
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> list(result = result, time = tt&lt;/span>&lt;span class="si">$toc&lt;/span>&lt;span class="s"> - tt&lt;/span>&lt;span class="si">$tic&lt;/span>&lt;span class="s">)
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s"> &amp;#34;&amp;#34;&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">return&lt;/span> &lt;span class="n">r_result&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="k">end&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="results">Results!&lt;/h2>
&lt;ul>
&lt;li>I use the &lt;a href="https://github.com/JuliaCI/BenchmarkTools.jl" target="_blank" rel="noopener">&lt;code>BenchmarkTools.jl&lt;/code>&lt;/a> package to benchmark the julia functions. This runs the functions multiple times to account for system noise. (running multiple times also gets rid of any JIT-related delays in julia)&lt;/li>
&lt;li>The &lt;code>R&lt;/code> functions are timed &lt;em>within&lt;/em> the R process using the &lt;code>tictoc&lt;/code> package, so even if there were any significant overhead from &lt;code>RCall.jl&lt;/code>, the measurement is immune to that.&lt;/li>
&lt;/ul>
&lt;p>Here is the output table, with &lt;code>n&lt;/code> for sample size, and times in seconds:&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>n&lt;/th>
&lt;th>jl&lt;/th>
&lt;th>jlg&lt;/th>
&lt;th>R&lt;/th>
&lt;th>Rmix&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>10000&lt;/td>
&lt;td>0.0388268&lt;/td>
&lt;td>0.0179957&lt;/td>
&lt;td>0.457&lt;/td>
&lt;td>0.073&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>100000&lt;/td>
&lt;td>0.366047&lt;/td>
&lt;td>0.16506&lt;/td>
&lt;td>5.068&lt;/td>
&lt;td>0.889&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>1000000&lt;/td>
&lt;td>3.99279&lt;/td>
&lt;td>1.75384&lt;/td>
&lt;td>47.522&lt;/td>
&lt;td>8.344&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>10000000&lt;/td>
&lt;td>46.833&lt;/td>
&lt;td>31.4021&lt;/td>
&lt;td>553.783&lt;/td>
&lt;td>65.379&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>And a much clearer picture using log scales:&lt;/p>
&lt;p>
&lt;figure >
&lt;div class="d-flex justify-content-center">
&lt;div class="w-100" >&lt;img src="https://floswald.github.io/img/EM-bench.png" alt="results" loading="lazy" data-zoomable />&lt;/div>
&lt;/div>&lt;/figure>
&lt;/p>
&lt;h2 id="conclusions">Conclusions&lt;/h2>
&lt;ol>
&lt;li>The naively hand-written code in &lt;code>julia&lt;/code> performs very well.&lt;/li>
&lt;li>The &lt;a href="https://github.com/davidavdav/GaussianMixtures.jl" target="_blank" rel="noopener">&lt;code>GaussianMixtures.jl&lt;/code>&lt;/a> performs best throughout&lt;/li>
&lt;li>Both julia implementations outperform the &lt;code>C&lt;/code>-optimized
&lt;a href="https://cran.r-project.org/web/packages/mixtools/index.html" target="_blank" rel="noopener">&lt;code>R mixtools&lt;/code>&lt;/a> package.&lt;/li>
&lt;li>The vectorized &lt;code>R&lt;/code> version comes in slowest.&lt;/li>
&lt;/ol>
&lt;p>I take from this that focusing on extending the work in &lt;a href="https://github.com/davidavdav/GaussianMixtures.jl" target="_blank" rel="noopener">&lt;code>GaussianMixtures.jl&lt;/code>&lt;/a> for my purposes is the most promising avenue here.&lt;/p>
&lt;h2 id="code-and-versions">Code and Versions&lt;/h2>
&lt;p>Code is on &lt;a href="https://github.com/floswald/EMbench.jl" target="_blank" rel="noopener">github&lt;/a> with full package version manifest.&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-julia" data-lang="julia">&lt;span class="line">&lt;span class="cl">&lt;span class="n">julia&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">versioninfo&lt;/span>&lt;span class="p">()&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Julia&lt;/span> &lt;span class="n">Version&lt;/span> &lt;span class="mf">1.1.0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Commit&lt;/span> &lt;span class="mi">80516&lt;/span>&lt;span class="n">ca202&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">2019&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">01&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">21&lt;/span> &lt;span class="mi">21&lt;/span>&lt;span class="o">:&lt;/span>&lt;span class="mi">24&lt;/span> &lt;span class="n">UTC&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Platform&lt;/span> &lt;span class="n">Info&lt;/span>&lt;span class="o">:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">OS&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">macOS&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">x86_64&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">darwin14&lt;/span>&lt;span class="mf">.5.0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">CPU&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">Intel&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">R&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">Core&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">TM&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="n">i5&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">5257&lt;/span>&lt;span class="n">U&lt;/span> &lt;span class="n">CPU&lt;/span> &lt;span class="err">@&lt;/span> &lt;span class="mf">2.70&lt;/span>&lt;span class="n">GHz&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">WORD_SIZE&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="mi">64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LIBM&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">libopenlibm&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">LLVM&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">libLLVM&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mf">6.0.1&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">ORCJIT&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="n">broadwell&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">shell&lt;/span>&lt;span class="o">&amp;gt;&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="o">--&lt;/span>&lt;span class="n">version&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R&lt;/span> &lt;span class="n">version&lt;/span> &lt;span class="mf">3.5.1&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">2018&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">07&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="mi">02&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">--&lt;/span> &lt;span class="s">&amp;#34;Feather Spray&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Copyright&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">C&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="mi">2018&lt;/span> &lt;span class="n">The&lt;/span> &lt;span class="n">R&lt;/span> &lt;span class="n">Foundation&lt;/span> &lt;span class="k">for&lt;/span> &lt;span class="n">Statistical&lt;/span> &lt;span class="n">Computing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">Platform&lt;/span>&lt;span class="o">:&lt;/span> &lt;span class="n">x86_64&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">apple&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">darwin15&lt;/span>&lt;span class="mf">.6.0&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">64&lt;/span>&lt;span class="o">-&lt;/span>&lt;span class="n">bit&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">R&lt;/span> &lt;span class="n">is&lt;/span> &lt;span class="n">free&lt;/span> &lt;span class="n">software&lt;/span> &lt;span class="n">and&lt;/span> &lt;span class="n">comes&lt;/span> &lt;span class="n">with&lt;/span> &lt;span class="n">ABSOLUTELY&lt;/span> &lt;span class="n">NO&lt;/span> &lt;span class="n">WARRANTY&lt;/span>&lt;span class="o">.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">You&lt;/span> &lt;span class="n">are&lt;/span> &lt;span class="n">welcome&lt;/span> &lt;span class="n">to&lt;/span> &lt;span class="n">redistribute&lt;/span> &lt;span class="n">it&lt;/span> &lt;span class="n">under&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">terms&lt;/span> &lt;span class="n">of&lt;/span> &lt;span class="n">the&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">GNU&lt;/span> &lt;span class="n">General&lt;/span> &lt;span class="n">Public&lt;/span> &lt;span class="n">License&lt;/span> &lt;span class="n">versions&lt;/span> &lt;span class="mi">2&lt;/span> &lt;span class="n">or&lt;/span> &lt;span class="mf">3.&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">For&lt;/span> &lt;span class="n">more&lt;/span> &lt;span class="n">information&lt;/span> &lt;span class="n">about&lt;/span> &lt;span class="n">these&lt;/span> &lt;span class="n">matters&lt;/span> &lt;span class="n">see&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">http&lt;/span>&lt;span class="o">://&lt;/span>&lt;span class="n">www&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">gnu&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">org&lt;/span>&lt;span class="o">/&lt;/span>&lt;span class="n">licenses&lt;/span>&lt;span class="o">/.&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>